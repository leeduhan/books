

**프로그램이 새로운 기능을 추가 하기에 편한 구조가 아니라면, 먼저 기능을 추가 하기 쉬운 형태로 리팩터링 하고 나서 원하는 기능을 추가 한다.**

- 오래 사용할 프로그램 이라면 중복 코드는 골칫거리가 된다. 
- 정책이 복잡 해질수록 수정할 부분을 찾기 어려워지고 수정 과정에서 실수할 가능성이 커진다. 
- 리펙토링이 필요한 이유는 바로 이런 정책의 변경 때문이다. 나중에 변경될 일이 전혀 없다면 현재 상태를 놔둬도 문제가 되지 않는다. 그러다 다른 사람이 읽고 이해 해야할 일이 생겼는데 로직을 파악 하기 어렵다면 뭔가 대책을 세워야 한다. 

# 리팩터링 첫단계

## 리팩터링하기 전에 제대로된 테스트 부터 마련한다. 테스트는 반드시 자가 진단 하도록 만든다 

테스트 프로그램을 이용해서 모든 테스트를 단축키 하나로 실행하게 설정해 둔다. 테스트 결과는 정답 과 같다면 통과인 초록색으로 표시하고 실패 하면 빨간색으로 표시 한다. 즉 성공 / 실패를 스스로 판단하는 자가 진단 테스트를 만들어야 한다. 이를 통해 실수의 가능성을 크게 줄일수 있다.

## 함수 추출하기 

함수를 리팩터링 할때는 전체 동작을 각각의 부분으로 나눌수 있는 지점을 찾는다. 즉 동작을 쪼갠다.

동작을 쪼갠 코드 조각은 별도 함수로 분리 하고 그 코드가 하는일을 설명하는 이름을 지어 준다.

함수를 분리 했을때 유효범위를 벗어나는 변수, 즉 새함수에서 곧바로 사용할수 없는 변수가 있는지 확인한다. 이런 변수는 매개 변수로 전달 한다.

함수 안에서 값이 변경되는 변수는 함수 내부에서 변환 이후 리턴하게 작성한다.

## 리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을수 있다.

한가지를 수정 할때마다 테스트하면 오류가 생기더라도 변경의 폭이 작기 때문에 문제를 찾고 해결하기가 훨씬 쉽다. 조금씩 변경하고 매번 테스트 하는것이 리팩토링 절차의 핵심이다. 한번에 수정하면 디버깅 하기 어려워 결과적으로 작업 시간이 늘어난다.

## 임시변수를 질의 함수로 바꾸기 

임시변수는 최대한 사용하지 않거나 없앤다. 그 방법중 하나가 임시 변수를 함수로 대체 하는 것이다. 지역 변수를 제거 해서 얻는 가장 큰 장점은 함수 추출 작업이 훨씬 쉬워진다. 유효범위를 신경 써야 할 대상이 줄어 들기 때문이다. 그래서 추출 작업전 항상 지역 변수부터 제거 한다.

## 변수를 인라인 하기

변수가 매개변수로 사용되는 경우 함수의 인자로 함수를 넣어서 한줄로 만든다.

## 함수 선언 바꾸기

함수의 이름이 적절하지 않다면 함수 이름을 변경 한다. 긴 함수를 작게 쪼개는 리팩터링은 이름을 잘 지어야만 효과가 있다.

>`위 3개는 요즘 내가 추구하는 스타일이다. 최대한 변수를 만들지 않고, 변수가 데이터에 따라서 바뀌는 경우 함수로 만들어 변수 대신 사용하고, 되도록 짦은 로직으로 대체 할수 있게 인라인 문법 filter, map, reduce, 애로우 함수, 중첩함수, 삼항연산자  및 || 연산 등을 적극적으로 사용한다.`

## 반복문 쪼개기 

for 루프 안에서 루프때마다 값을 누적 하는 변수의 리팩토링은 까다롭다. 먼저 값을 누적 하는 부분을 함수로 따로 분리한다. 그 이후는 위와 동일한 작업을 수행한다. 

## 리팩터링과 성능 문제

결과적으로 for 루프 하나에서 처리 되던 로직을 두번의 루프를 통해 결과를 얻어내는 방식으로 구현되게 된다. 반복문을 쪼개서 성능이 느려지지 않을까 걱정 할수 있다. 하지만 이정도 중복은 성능에 미치는 영향이 미비 할때가 많다. 실제 실행 시간을 측정해 보면 거의 차이를 느끼지 못한다.

경험 많은 프로그래머 조차 코드의 실제 성능을 정확히 예측하지 못한다. 똑똑한 컴파일러들은 최신 캐싱 기법으로 무장 하고 있어 우리의 직관을 초월하는 결과를 내어 주기 때문이다. 

잘 다듬어진 코드는 성능 개선 작업도 수월하다. 리팩토링 과정에서 성능이 크게 떨어졌다면 리팩토링후 성능을 개선한다. 이과정에서 예전 코드로 돌아가기도 하지만 대체로 리팩토링 덕분에 성능 개선을 더 효과적으로 수행 할수 있다.

따라서 리팩터링으로 인한 성능 문제애 대한 내조언은 특별한 경우가 아니면 일단 무시하라 이다. 하던 리팩터링을 마무리 하고 성능 개선을 하는게 좋다.

# 계산 단계와 포멧팅 단계 분리기하기 

## 단계 쪼개기 

로직을 두단계로 나눈다. 첫 단계는 데이터를 처리하고, 다음 단계에서 결과를 텍스트나 html로 표현하는 포멧팅을 한다. 다시 말하면 첫번째 단계 에서 두번째 단계로 전달할 중간 데이터 구조를 만드는 것이다. 

이과정에서 함수로 받은 데이터는 최대한 불변(immutable)으로 취급해야 한다. 

## 반복문을 파이프라인 으로 바꾸기

for 루프를 reduce 로 변경하기
# 조건부 로직을 다형성으로 바꾸기 

상속 계층 부터 정의 해야 한다. 

## 타입코드를 서브클래스로 바꾸기 

## 생성자를 팩토리 함수로 바꾸기

## 조건부 로직을 다형성으로 바꾸기 

# 상태점검 : 다형성을 활용하여 데이터 생성하기 

**좋은 코드를 가늠하는 확실한 방법은 '얼마나 수정하기 쉬운가'다.**

코드는 명확해야 한다. 코드를 수정해야할 상황이 되면 고쳐야할 곳을 쉽게 찾을수 있고 오류없이 빠르게 수정할수 있어야 한다. 

리팩토링을 효과적으로 하는 핵심은, 단계를 잘개 나눠야 더 빠르게 처리 할수 있고, 코드는 절대로 깨지지 않으며, 이러한 작은 단계들이 모여서 큰 변화를 이룰수 있다.


